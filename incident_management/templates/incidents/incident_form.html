{% extends 'base/base.html' %}

{% block title %}{{ action }} {{ network_type }} Incident{% endblock %}

{% block extra_css %}
<style>
/* Professional form styling */
.form-section {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
}

.form-section h5 {
    color: #495057;
    border-bottom: 2px solid #007bff;
    padding-bottom: 8px;
    margin-bottom: 20px;
}

.required-field {
    color: #dc3545;
    font-weight: bold;
}

.form-control, .form-select {
    border: 1px solid #ced4da;
    border-radius: 6px;
    padding: 10px 12px;
    font-size: 14px;
}

.form-control:focus, .form-select:focus {
    border-color: #007bff;
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
}

.btn-submit {
    background: linear-gradient(45deg, #007bff, #0056b3);
    border: none;
    padding: 12px 30px;
    border-radius: 6px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.btn-submit:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0, 123, 255, 0.3);
}

.alert-info {
    background: linear-gradient(45deg, #d1ecf1, #bee5eb);
    border: 1px solid #b6d4db;
    color: #0c5460;
}

.network-icon {
    font-size: 1.2em;
    margin-right: 8px;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="alert alert-info">
                <h4 class="mb-2">
                    <i class="bi bi-{% if action == 'Edit' %}pencil{% else %}plus-circle-fill{% endif %} me-2"></i>
                    {{ action }} Incident - {{ network_type }}
                </h4>
                <p class="mb-0">Complete all required fields marked with <span class="required-field">*</span>.</p>
            </div>
        </div>
    </div>

    <!-- Main Form -->
    <form method="post" id="incidentForm">
        {% csrf_token %}
        
        <!-- Network-Specific Section -->
        {% if 'Transport' in network_type %}
            <!-- Transport Networks Form -->
            <div class="form-section">
                <h5><i class="bi bi-diagram-3 network-icon"></i>Transport Network Details</h5>
                <div class="row">
                    <div class="col-md-6">
                        <label class="form-label fw-bold">
                            Region / Loop <span class="required-field">*</span>
                        </label>
                        <select name="region_loop" class="form-select" required>
                            <option value="">--- Select Region/Loop ---</option>
                            {% for config in region_choices %}
                                <option value="{{ config.value }}" 
                                    {% if incident.region_loop == config.value %}selected{% endif %}>
                                    {{ config.value }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label fw-bold">
                            System / Capacity <span class="required-field">*</span>
                        </label>
                        <select name="system_capacity" class="form-select" required>
                            <option value="">--- Select System/Capacity ---</option>
                            {% for config in system_choices %}
                                <option value="{{ config.value }}"
                                    {% if incident.system_capacity == config.value %}selected{% endif %}>
                                    {{ config.value }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                
                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="card border-primary">
                            <div class="card-header bg-primary text-white">
                                <h6 class="mb-0">Extremity A</h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label">DOT Extremity(A)</label>
                                    <select name="dot_extremity_a" class="form-select">
                                        <option value="">--- Select DOT State ---</option>
                                        {% for config in dot_choices %}
                                            <option value="{{ config.value }}"
                                                {% if incident.dot_extremity_a == config.value %}selected{% endif %}>
                                                {{ config.value }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div>
                                    <label class="form-label fw-bold">
                                        Extremity(A) <span class="required-field">*</span>
                                    </label>
                                    <input type="text" name="extremity_a" class="form-control" 
                                        placeholder="Enter extremity A location" required
                                        value="{{ incident.extremity_a|default:'' }}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card border-warning">
                            <div class="card-header bg-warning text-dark">
                                <h6 class="mb-0">Extremity B</h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">
                                        DOT Extremity(B) <span class="required-field">*</span>
                                    </label>
                                    <select name="dot_extremity_b" class="form-select" required>
                                        <option value="">--- Select DOT State ---</option>
                                        {% for config in dot_choices %}
                                            <option value="{{ config.value }}"
                                                {% if incident.dot_extremity_b == config.value %}selected{% endif %}>
                                                {{ config.value }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div>
                                    <label class="form-label fw-bold">
                                        Extremity(B) <span class="required-field">*</span>
                                    </label>
                                    <input type="text" name="extremity_b" class="form-control" 
                                        placeholder="Enter extremity B location" required
                                        value="{{ incident.extremity_b|default:'' }}">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-3">
                    <div class="col-12">
                        <label class="form-label fw-bold">Responsibility</label>
                        <select name="responsibility" class="form-select">
                            <option value="">--- Select Responsibility ---</option>
                            <option value="A" {% if incident.responsibility == 'A' %}selected{% endif %}>A</option>
                            <option value="B" {% if incident.responsibility == 'B' %}selected{% endif %}>B</option>
                            <option value="Both" {% if incident.responsibility == 'Both' %}selected{% endif %}>Both</option>
                        </select>
                        <small class="text-muted">Select responsibility assignment (optional)</small>
                    </div>
                </div>
            </div>
        {% elif 'File Access' in network_type %}
            <!-- File Access Networks Form -->
            <div class="form-section">
                <h5><i class="bi bi-hdd-network network-icon"></i>File Access Network Details</h5>
                <div class="row">
                    <div class="col-md-4">
                        <label class="form-label fw-bold">
                            DO / WILAYA <span class="required-field">*</span>
                        </label>
                        <select name="do_wilaya" class="form-select" required>
                            <option value="">--- Select Wilaya ---</option>
                            {% for config in wilaya_choices %}
                                <option value="{{ config.value }}"
                                    {% if incident.do_wilaya == config.value %}selected{% endif %}>
                                    {{ config.value }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label fw-bold">
                            Zone / Metro <span class="required-field">*</span>
                        </label>
                        <input type="text" name="zone_metro" class="form-control" 
                               placeholder="Enter zone/metro area" required
                               value="{{ incident.zone_metro|default:'' }}">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label fw-bold">
                            Site <span class="required-field">*</span>
                        </label>
                        <input type="text" name="site" class="form-control" 
                               placeholder="Enter site identification" required
                               value="{{ incident.site|default:'' }}">
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-6">
                        <label class="form-label fw-bold">
                            IP Address <span class="required-field">*</span>
                        </label>
                        <input type="text" name="ip_address" class="form-control" 
                               placeholder="Enter IP address (e.g., 192.168.1.1)" required
                               value="{{ incident.ip_address|default:'' }}">
                        <small class="text-muted">IPv4 or IPv6 address format</small>
                    </div>
                </div>
            </div>
        {% elif 'Radio Access' in network_type %}
            <!-- Radio Access Networks Form -->
            <div class="form-section">
                <h5><i class="bi bi-broadcast network-icon"></i>Radio Access Network Details</h5>
                <div class="row">
                    <div class="col-md-4">
                        <label class="form-label fw-bold">
                            DO / WILAYA <span class="required-field">*</span>
                        </label>
                        <select name="do_wilaya" class="form-select" required>
                            <option value="">--- Select Wilaya ---</option>
                            {% for config in wilaya_choices %}
                                <option value="{{ config.value }}"
                                    {% if incident.do_wilaya == config.value %}selected{% endif %}>
                                    {{ config.value }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label fw-bold">
                            Site <span class="required-field">*</span>
                        </label>
                        <input type="text" name="site" class="form-control" 
                               placeholder="Enter site identification" required
                               value="{{ incident.site|default:'' }}">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label fw-bold">
                            IP Address <span class="required-field">*</span>
                        </label>
                        <input type="text" name="ip_address" class="form-control" 
                               placeholder="Enter IP address (e.g., 192.168.1.1)" required
                               value="{{ incident.ip_address|default:'' }}">
                        <small class="text-muted">IPv4 or IPv6 address format</small>
                    </div>
                </div>
            </div>
        {% elif 'Core' in network_type %}
            <!-- Core Networks Form -->
            <div class="form-section">
                <h5><i class="bi bi-cpu network-icon"></i>Core Network Details</h5>
                <div class="row">
                    <div class="col-md-4">
                        <label class="form-label fw-bold">
                            Platform <span class="required-field">*</span>
                        </label>
                        <select name="platform" class="form-select" required>
                            <option value="">--- Select Platform ---</option>
                            {% for config in platform_choices %}
                                <option value="{{ config.value }}"
                                    {% if incident.platform == config.value %}selected{% endif %}>
                                    {{ config.value }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label fw-bold">
                            Region / Node <span class="required-field">*</span>
                        </label>
                        <select name="region_node" class="form-select" required>
                            <option value="">--- Select Region/Node ---</option>
                            {% for config in region_node_choices %}
                                <option value="{{ config.value }}"
                                    {% if incident.region_node == config.value %}selected{% endif %}>
                                    {{ config.value }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label fw-bold">Site</label>
                        <input type="text" name="site" class="form-control" 
                               placeholder="Enter site (optional)"
                               value="{{ incident.site|default:'' }}">
                    </div>
                </div>
                
                <!-- Optional Extremity Information -->
                <div class="row mt-3">
                    <div class="col-12">
                        <h6 class="text-muted">Extremity Information (Optional)</h6>
                    </div>
                    <div class="col-md-6">
                        <div class="card border-info">
                            <div class="card-header bg-info text-white">
                                <h6 class="mb-0">Extremity A</h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label">DOT Extremity(A)</label>
                                    <select name="dot_extremity_a" class="form-select">
                                        <option value="">--- Select DOT State ---</option>
                                        {% for config in dot_choices %}
                                            <option value="{{ config.value }}"
                                                {% if incident.dot_extremity_a == config.value %}selected{% endif %}>
                                                {{ config.value }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div>
                                    <label class="form-label">Extremity(A)</label>
                                    <input type="text" name="extremity_a" class="form-control" 
                                           placeholder="Enter extremity A location"
                                           value="{{ incident.extremity_a|default:'' }}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card border-warning">
                            <div class="card-header bg-warning text-dark">
                                <h6 class="mb-0">Extremity B</h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label">DOT Extremity(B)</label>
                                    <select name="dot_extremity_b" class="form-select">
                                        <option value="">--- Select DOT State ---</option>
                                        {% for config in dot_choices %}
                                            <option value="{{ config.value }}"
                                                {% if incident.dot_extremity_b == config.value %}selected{% endif %}>
                                                {{ config.value }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div>
                                    <label class="form-label">Extremity(B)</label>
                                    <input type="text" name="extremity_b" class="form-control" 
                                           placeholder="Enter extremity B location"
                                           value="{{ incident.extremity_b|default:'' }}">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% elif 'Backbone' in network_type %}
            <!-- Backbone Internet Networks Form -->
            <div class="form-section">
                <h5><i class="bi bi-globe network-icon"></i>Backbone Internet Network Details</h5>
                <div class="row">
                    <div class="col-md-4">
                        <label class="form-label fw-bold">
                            Interconnect Type <span class="required-field">*</span>
                        </label>
                        <select name="interconnect_type" class="form-select" required>
                            <option value="">--- Select Interconnect Type ---</option>
                            {% for config in interconnect_choices %}
                                <option value="{{ config.value }}"
                                    {% if incident.interconnect_type == config.value %}selected{% endif %}>
                                    {{ config.value }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label fw-bold">
                            Platform/IGW <span class="required-field">*</span>
                        </label>
                        <select name="platform_igw" class="form-select" required>
                            <option value="">--- Select Platform/IGW ---</option>
                            {% for config in platform_igw_choices %}
                                <option value="{{ config.value }}"
                                    {% if incident.platform_igw == config.value %}selected{% endif %}>
                                    {{ config.value }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label fw-bold">
                            Link Label <span class="required-field">*</span>
                        </label>
                        <input type="text" name="link_label" class="form-control" 
                               placeholder="Enter link label" required
                               value="{{ incident.link_label|default:'' }}">
                    </div>
                </div>
            </div>
        {% endif %}

        <!-- Timing Section -->
        <div class="form-section">
            <h5><i class="bi bi-clock me-2"></i>Incident Timing</h5>
            <div class="row">
                <div class="col-md-6">
                    <label class="form-label fw-bold">
                        Date and Time of Incident <span class="required-field">*</span>
                    </label>
                    <input type="datetime-local" 
                           name="date_time_incident" 
                           id="incidentDateTime"
                           class="form-control" 
                           required 
                           step="60"
                           value="{{ form.date_time_incident.value|default:'' }}">
                    <small class="text-muted">When did the incident occur?</small>
                </div>
                <div class="col-md-6">
                    <label class="form-label fw-bold">Date and Time of Recovery</label>
                    <input type="datetime-local" 
                           name="date_time_recovery" 
                           id="recoveryDateTime"
                           class="form-control" 
                           step="60"
                           value="{{ form.date_time_recovery.value|default:'' }}">
                    <small class="text-muted">Leave empty if incident is still active</small>
                </div>
            </div>
        </div>

        <!-- Analysis Section -->
        <div class="form-section">
            <h5><i class="bi bi-search me-2"></i>Analysis Information</h5>
            <div class="row">
                <div class="col-md-6">
                    <label class="form-label fw-bold">Cause</label>
                    <select name="cause" class="form-select">
                        <option value="">--- Select Cause ---</option>
                        {% for config in cause_choices %}
                            <option value="{{ config.value }}"
                                {% if incident.cause == config.value %}selected{% endif %}>
                                {{ config.value }}
                            </option>
                        {% endfor %}
                    </select>
                    <small class="text-muted">Root cause of the incident (optional)</small>
                </div>
                <div class="col-md-6">
                    <label class="form-label fw-bold">Origin</label>
                    <select name="origin" class="form-select">
                        <option value="">--- Select Origin ---</option>
                        {% for config in origin_choices %}
                            <option value="{{ config.value }}"
                                {% if incident.origin == config.value %}selected{% endif %}>
                                {{ config.value }}
                            </option>
                        {% endfor %}
                    </select>
                    <small class="text-muted">Source/origin of the incident (optional)</small>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-12">
                    <label class="form-label fw-bold">Impact / Comment</label>
                    <textarea name="impact_comment" class="form-control" rows="4" 
                              placeholder="Describe the impact and any additional comments...">{{ incident.impact_comment|default:'' }}</textarea>
                    <small class="text-muted">Detailed description of the incident impact</small>
                </div>
            </div>
        </div>

        <!-- Submit Section -->
        <div class="row">
            <div class="col-12 text-end">
                <a href="javascript:history.back()" class="btn btn-outline-secondary me-3">
                    <i class="bi bi-x-lg me-2"></i>Cancel
                </a>
                <button type="submit" class="btn btn-primary btn-submit">
                    <i class="bi bi-check-lg me-2"></i>
                    {% if action == 'Edit' %}Update Incident{% else %}Create Incident{% endif %}
                </button>
            </div>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Set current time for new incidents only
    {% if action == 'Add New' %}
        const incidentTimeInput = document.getElementById('incidentDateTime');
        if (incidentTimeInput && !incidentTimeInput.value) {
            const now = new Date();
            const localDateTime = new Date(now.getTime() - (now.getTimezoneOffset() * 60000));
            incidentTimeInput.value = localDateTime.toISOString().slice(0, 16);
        }
    {% endif %}
});
</script>
{% endblock %}