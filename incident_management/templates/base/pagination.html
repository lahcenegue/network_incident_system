<!-- Modern Advanced Pagination Component -->
{% if page_obj %}
<div class="pagination-container">
  <div class="pagination-info">
    <span class="pagination-text">
      Showing {{ page_obj.start_index }}-{{ page_obj.end_index }} of {{ page_obj.paginator.count }} incidents
    </span>
  </div>
  
  <nav aria-label="Incident pagination">
    <ul class="pagination-nav">
      <!-- First Page -->
      {% if page_obj.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?{% if request.GET.urlencode %}{{ request.GET.urlencode|safe }}&{% endif %}page=1" aria-label="First page">
            <i class="bi bi-chevron-double-left"></i>
          </a>
        </li>
        
        <!-- Previous Page -->
        <li class="page-item">
          <a class="page-link" href="?{% if request.GET.urlencode %}{{ request.GET.urlencode|safe }}&{% endif %}page={{ page_obj.previous_page_number }}" aria-label="Previous page">
            <i class="bi bi-chevron-left"></i>
          </a>
        </li>
      {% endif %}
      
      <!-- Page Numbers with Smart Range -->
      {% with page_obj.number as current_page %}
        {% with page_obj.paginator.num_pages as total_pages %}
          {% if total_pages <= 7 %}
            <!-- Show all pages if 7 or fewer -->
            {% for page_num in page_obj.paginator.page_range %}
              <li class="page-item {% if page_num == current_page %}active{% endif %}">
                <a class="page-link" href="?{% if request.GET.urlencode %}{{ request.GET.urlencode|safe }}&{% endif %}page={{ page_num }}">{{ page_num }}</a>
              </li>
            {% endfor %}
          {% else %}
            <!-- Smart pagination for many pages -->
            {% if current_page <= 4 %}
              <!-- Show first 5 pages + ... + last page -->
              {% for page_num in "12345"|make_list %}
                {% if page_num|add:0 <= total_pages %}
                  <li class="page-item {% if page_num|add:0 == current_page %}active{% endif %}">
                    <a class="page-link" href="?{% if request.GET.urlencode %}{{ request.GET.urlencode|safe }}&{% endif %}page={{ page_num }}">{{ page_num }}</a>
                  </li>
                {% endif %}
              {% endfor %}
              {% if total_pages > 6 %}
                <li class="page-item disabled"><span class="page-link">...</span></li>
                <li class="page-item">
                  <a class="page-link" href="?{% if request.GET.urlencode %}{{ request.GET.urlencode|safe }}&{% endif %}page={{ total_pages }}">{{ total_pages }}</a>
                </li>
              {% endif %}
            {% elif current_page >= total_pages|add:"-3" %}
              <!-- Show first page + ... + last 5 pages -->
              <li class="page-item">
                <a class="page-link" href="?{% if request.GET.urlencode %}{{ request.GET.urlencode|safe }}&{% endif %}page=1">1</a>
              </li>
              {% if total_pages > 6 %}
                <li class="page-item disabled"><span class="page-link">...</span></li>
              {% endif %}
              {% for page_num in total_pages|add:"-4,1,2,3,4"|make_list %}
                {% with page_num|add:total_pages|add:"-4" as actual_page %}
                  {% if actual_page > 1 and actual_page <= total_pages %}
                    <li class="page-item {% if actual_page == current_page %}active{% endif %}">
                      <a class="page-link" href="?{% if request.GET.urlencode %}{{ request.GET.urlencode|safe }}&{% endif %}page={{ actual_page }}">{{ actual_page }}</a>
                    </li>
                  {% endif %}
                {% endwith %}
              {% endfor %}
            {% else %}
              <!-- Show first + ... + current-1, current, current+1 + ... + last -->
              <li class="page-item">
                <a class="page-link" href="?{% if request.GET.urlencode %}{{ request.GET.urlencode|safe }}&{% endif %}page=1">1</a>
              </li>
              <li class="page-item disabled"><span class="page-link">...</span></li>
              
              {% for page_num in current_page|add:"-1,0,1"|make_list %}
                {% with page_num|add:current_page|add:"-1" as actual_page %}
                  <li class="page-item {% if actual_page == current_page %}active{% endif %}">
                    <a class="page-link" href="?{% if request.GET.urlencode %}{{ request.GET.urlencode|safe }}&{% endif %}page={{ actual_page }}">{{ actual_page }}</a>
                  </li>
                {% endwith %}
              {% endfor %}
              
              <li class="page-item disabled"><span class="page-link">...</span></li>
              <li class="page-item">
                <a class="page-link" href="?{% if request.GET.urlencode %}{{ request.GET.urlencode|safe }}&{% endif %}page={{ total_pages }}">{{ total_pages }}</a>
              </li>
            {% endif %}
          {% endif %}
        {% endwith %}
      {% endwith %}
      
      <!-- Next Page -->
      {% if page_obj.has_next %}
        <li class="page-item">
          <a class="page-link" href="?{% if request.GET.urlencode %}{{ request.GET.urlencode|safe }}&{% endif %}page={{ page_obj.next_page_number }}" aria-label="Next page">
            <i class="bi bi-chevron-right"></i>
          </a>
        </li>
        
        <!-- Last Page -->
        <li class="page-item">
          <a class="page-link" href="?{% if request.GET.urlencode %}{{ request.GET.urlencode|safe }}&{% endif %}page={{ page_obj.paginator.num_pages }}" aria-label="Last page">
            <i class="bi bi-chevron-double-right"></i>
          </a>
        </li>
      {% endif %}
    </ul>
  </nav>
  
  <!-- Page Size Selector -->
  <div class="pagination-controls">
    <label for="pageSize" class="pagination-label">Per page:</label>
    <select id="pageSize" class="pagination-select" onchange="changePageSize(this.value)">
      <option value="25" {% if request.GET.size == "25" %}selected{% endif %}>25</option>
      <option value="50" {% if request.GET.size == "50" %}selected{% endif %}>50</option>
      <option value="100" {% if request.GET.size == "100" %}selected{% endif %}>100</option>
    </select>
  </div>
</div>

<style>
.pagination-container {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 24px;
  background: var(--surface-secondary);
  border-top: 1px solid var(--border-light);
  gap: 20px;
  flex-wrap: wrap;
}

.pagination-info {
  color: var(--text-secondary);
  font-size: 14px;
}

.pagination-nav {
  display: flex;
  list-style: none;
  margin: 0;
  padding: 0;
  gap: 4px;
}

.page-item {
  display: flex;
}

.page-link {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 36px;
  height: 36px;
  border: 1px solid var(--border-light);
  border-radius: var(--radius-sm);
  background: var(--surface-primary);
  color: var(--text-secondary);
  text-decoration: none;
  font-size: 14px;
  font-weight: 500;
  transition: all 0.15s ease;
}

.page-link:hover {
  background: var(--surface-secondary);
  border-color: var(--border-medium);
  color: var(--text-primary);
}

.page-item.active .page-link {
  background: #3b82f6;
  border-color: #3b82f6;
  color: white;
}

.page-item.disabled .page-link {
  color: var(--text-muted);
  cursor: not-allowed;
  background: var(--surface-tertiary);
}

.pagination-controls {
  display: flex;
  align-items: center;
  gap: 8px;
}

.pagination-label {
  font-size: 14px;
  color: var(--text-secondary);
}

.pagination-select {
  border: 1px solid var(--border-light);
  border-radius: var(--radius-sm);
  padding: 4px 8px;
  font-size: 14px;
  background: var(--surface-primary);
}

@media (max-width: 768px) {
  .pagination-container {
    flex-direction: column;
    gap: 12px;
  }
  
  .pagination-nav {
    gap: 2px;
  }
  
  .page-link {
    width: 32px;
    height: 32px;
    font-size: 12px;
  }
}
</style>

<script>
function changePageSize(size) {
  const url = new URL(window.location);
  url.searchParams.set('size', size);
  url.searchParams.set('page', '1'); // Reset to first page
  window.location.href = url.toString();
}
</script>
{% endif %}